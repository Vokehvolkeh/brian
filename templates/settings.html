<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Contacts | Business Hub</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #4f46e5; /* Indigo for vibrancy */
        --secondary-color: #f9fafb; /* Soft gray */
        --accent-color: #7dd3fc; /* Sky blue */
        --highlight-color: #f472b6; /* Pink for fun */
        --text-color: #1e293b; /* Dark slate */
        --success-color: #34d399; /* Emerald */
        --danger-color: #f87171; /* Coral red */
        --tile-bg: #ffffff;
        --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", sans-serif;
        min-height: 100vh;
        background: linear-gradient(
          135deg,
          var(--accent-color),
          var(--primary-color)
        );
        color: var(--text-color);
        display: flex;
        flex-direction: column;
      }

      /* Sidebar */
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 290px;
        height: 100vh;
        background: linear-gradient(180deg, var(--primary-color), #4338ca);
        color: black;
        padding: 16px;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 1000;
        overflow-y: auto;
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .sidebar h2 {
        font-size: 1.5rem;
        font-weight: 700;
        text-align: center;
        margin-bottom: 1.5rem;
        color: rgb(12, 3, 3);
      }

      .sidebar a {
        display: flex;
        align-items: center;
        gap: 8px;
        color: rgb(10, 1, 1);
        text-decoration: none;
        padding: 10px;
        margin: 6px 0;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .sidebar a:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateX(4px);
      }

      .menu-toggle {
        position: fixed;
        top: 12px;
        left: 12px;
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 1.25rem;
        cursor: pointer;
        z-index: 1001;
        transition: background 0.3s ease;
      }

      .menu-toggle:hover {
        background: var(--highlight-color);
      }

      /* Main Content */
      .main-content {
        width: 100%;
        max-width: 1000px;
        margin: 4rem auto 2rem;
        padding: 16px;
      }

      h1 {
        font-size: 2rem;
        font-weight: 800;
        color: white;
        text-align: center;
        margin-bottom: 2rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .card {
        background: var(--tile-bg);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: var(--card-shadow);
        margin-bottom: 2rem;
        transition: transform 0.3s ease;
      }

      .card:hover {
        transform: translateY(-4px);
      }

      h2 {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 1rem;
        text-align: center;
        position: relative;
      }

      h2::after {
        content: "";
        position: absolute;
        bottom: -4px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: linear-gradient(
          to right,
          var(--accent-color),
          var(--highlight-color)
        );
        border-radius: 2px;
      }

      /* Form Styles */
      .form-group {
        margin-bottom: 1rem;
      }

      .form-group label {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 0.4rem;
        display: block;
      }

      .form-control {
        width: 100%;
        padding: 0.6rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.9rem;
        color: var(--text-color);
        background: var(--secondary-color);
        transition: all 0.3s ease;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(125, 211, 252, 0.2);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.6rem 1.2rem;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
      }

      .btn-primary {
        background: var(--accent-color);
        color: white;
      }

      .btn-primary:hover {
        background: var(--highlight-color);
        transform: translateY(-1px);
      }

      /* Table Styles */
      .contact-table {
        width: 100%;
        border-collapse: collapse;
        background: var(--tile-bg);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: var(--card-shadow);
        margin-bottom: 1.5rem;
      }

      .contact-table th,
      .contact-table td {
        padding: 10px;
        text-align: left;
        font-size: 0.85rem;
        border-bottom: 1px solid #e5e7eb;
      }

      .contact-table th {
        background: var(--primary-color);
        color: white;
        font-weight: 600;
        text-transform: uppercase;
      }

      .contact-table tbody tr:hover {
        background: #f1f5f9;
      }

      .contact-table .btn-sm {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
      }

      .btn-success {
        background: var(--success-color);
        color: white;
      }

      .btn-success:hover {
        background: #2ea67a;
      }

      .btn-danger {
        background: var(--danger-color);
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      /* Search Bar */
      .search-bar {
        display: flex;
        gap: 8px;
        margin-bottom: 1.5rem;
      }

      .search-bar input {
        flex: 1;
        padding: 0.6rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.9rem;
      }

      .search-bar .btn {
        background: var(--primary-color);
      }

      .search-bar .btn:hover {
        background: var(--highlight-color);
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 1.5rem;
        color: #64748b;
      }

      .empty-icon {
        font-size: 2.5rem;
        margin-bottom: 0.8rem;
        color: #cbd5e1;
        animation: bounce 2s infinite;
      }

      .empty-text {
        font-size: 0.9rem;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-8px);
        }
      }

      .card,
      .contact-table {
        animation: fadeIn 0.5s ease-out forwards;
      }

      /* Fun Feature: Confetti Toggle (Inactive by Default) */
      .confetti-toggle {
        position: fixed;
        bottom: 16px;
        right: 16px;
        background: var(--highlight-color);
        color: white;
        padding: 8px 12px;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: var(--card-shadow);
        font-size: 1.2rem;
        transition: transform 0.3s ease;
      }

      .confetti-toggle:hover {
        transform: rotate(360deg);
      }

      /* Responsive Design */
      @media (min-width: 768px) {
        body {
          flex-direction: row;
        }

        .sidebar {
          transform: translateX(0);
          width: 220px;
          padding: 20px;
        }

        .main-content {
          width: 100%;
          max-width: 1200px; /* expand for desktop dashboards */
          margin: 4rem auto 2rem;
          padding: 16px;
        }

        .menu-toggle {
          display: none;
        }

        h1 {
          font-size: 2.25rem;
        }

        .contact-table th,
        .contact-table td {
          padding: 12px;
          font-size: 0.9rem;
        }
      }
      @media (min-width: 768px) {
        .main-content {
          margin: 4rem 2rem 2rem 240px; /* top right bottom left */
          max-width: calc(100% - 260px); /* so it fits next to sidebar */
        }
      }
      @media (max-width: 480px) {
        h1 {
          font-size: 1.75rem;
        }

        .card {
          padding: 1.25rem;
        }

        .contact-table th,
        .contact-table td {
          padding: 8px;
          font-size: 0.8rem;
        }

        .search-bar {
          flex-direction: column;
        }

        .search-bar input,
        .search-bar .btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>

    <div class="sidebar" id="sidebar">
      <nav
        class="flex flex-col space-y-3 bg-white shadow-md rounded-xl p-4 w-64"
      >
        <a
          href="/dashboard"
          class="flex items-center space-x-2 hover:bg-emerald-100 px-3 py-2 rounded-md"
        >
          üè† <span>Dashboard</span>
        </a>

        <a
          href="/settings"
          class="flex items-center space-x-2 hover:bg-emerald-100 px-3 py-2 rounded-md"
        >
          üìã <span>Manage Contacts</span>
        </a>

        <a
          href="/reports"
          class="flex items-center space-x-2 hover:bg-emerald-100 px-3 py-2 rounded-md"
        >
          üìà <span>Reports & Analytics</span>
        </a>

        <a
          href="/staff"
          class="flex items-center space-x-2 hover:bg-emerald-100 px-3 py-2 rounded-md"
        >
          üë• <span>Staff Management</span>
        </a>

        <a
          href="/finance"
          class="flex items-center space-x-2 hover:bg-emerald-100 px-3 py-2 rounded-md"
        >
          üí∏ <span>Finance & Billing</span>
        </a>

        <a
          href="/settings"
          class="flex items-center space-x-2 hover:bg-emerald-100 px-3 py-2 rounded-md"
        >
          ‚öôÔ∏è <span>System Settings</span>
        </a>

        <hr class="my-2" />

        <a
          href="/users"
          class="flex items-center space-x-2 hover:bg-emerald-100 px-3 py-2 rounded-md"
        >
          üîë <span>User Accounts</span>
        </a>

        <a
          href="/notifications"
          class="flex items-center space-x-2 hover:bg-emerald-100 px-3 py-2 rounded-md"
        >
          üîî <span>Notifications</span>
        </a>

        <a
          href="/support"
          class="flex items-center space-x-2 hover:bg-emerald-100 px-3 py-2 rounded-md"
        >
          üõ† <span>Support Center</span>
        </a>

        <a
          href="/logout"
          class="flex items-center space-x-2 text-red-600 hover:bg-red-100 px-3 py-2 rounded-md"
        >
          üö™ <span>Logout</span>
        </a>
      </nav>
    </div>

    <div class="main-content">
      <h1>üéâ Manage Contacts</h1>

      <!-- Search Bar -->
      <div class="search-bar">
        <input
          type="text"
          id="searchInput"
          class="form-control"
          placeholder="Search contacts..."
        />
        <button class="btn" onclick="searchContacts()">üîç Search</button>
      </div>

      <!-- Add Contact Form -->
      <div class="card">
        <h2>Add Company Contact Details</h2>
        <form action="/settings" method="POST">
          <div class="form-group">
            <label for="phone">Notification Phone Number</label>
            <input
              type="tel"
              id="phone"
              name="phone"
              class="form-control"
              placeholder="+1234567890"
              value="{{ data.phone }}"
              required
            />
          </div>
          <div class="form-group">
            <label for="arrival_time">Time of Arrival</label>
            <input
              type="time"
              id="arrival_time"
              name="time_in"
              class="form-control"
              value="{{ data.time_in }}"
              required
            />
          </div>
          <div class="form-group">
            <label for="leaving_time">Time of Leaving</label>
            <input
              type="time"
              id="leaving_time"
              name="time_out"
              class="form-control"
              value="{{ data.time_out }}"
              required
            />
          </div>
          <div class="form-group">
            <label for="company_email">Company Email</label>
            <input
              type="email"
              id="company_email"
              name="email"
              class="form-control"
              placeholder="contact@company.com"
              value="{{ data.email }}"
              required
            />
          </div>
          <div class="form-group">
            <label for="address">Company Address</label>
            <input
              type="text"
              id="address"
              name="address"
              class="form-control"
              placeholder="123 Business St, City"
              value="{{ data.address }}"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 mr-2"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd"
              />
            </svg>
            Save Contact Details
          </button>
        </form>
      </div>

      <!-- Contacts Table -->
      <div class="card">
        <h2>Registered Users</h2>
        {% if users %}
        <table class="contact-table">
          <thead>
            <tr>
              <th>Username</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="contactTableBody">
            {% for user in users %}
            <tr id="user-{{ user.id }}">
              <td>{{ user.username }}</td>
              <td>{{ user.email or 'N/A' }}</td>
              <td>{{ user.phone or 'N/A' }}</td>
              <td>
                <div class="flex gap-2">
                  <button
                    class="btn btn-success btn-sm"
                    onclick="toggleUserDetails('user{{ user.id }}')"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4 mr-1"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                      <path
                        fill-rule="evenodd"
                        d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    View
                  </button>
                  <button
                    class="btn btn-danger btn-sm"
                    onclick="deleteUser({{ user.id }})"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4 mr-1"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    Delete
                  </button>
                </div>
              </td>
            </tr>
            <tr class="user-details" id="user{{ user.id }}-details">
              <td colspan="4">
                <div class="detail-grid">
                  <div class="detail-item">
                    <span class="detail-label">Email</span>
                    <span class="detail-value">{{ user.email or 'N/A' }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Phone</span>
                    <span class="detail-value">{{ user.phone or 'N/A' }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Role</span>
                    <span class="detail-value">User</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Profile Photo</span>
                    <span class="detail-value">
                      {% if user.profile_photo %}
                      <img
                        src="{{ url_for('static', filename='Uploads/' + user.profile_photo) }}"
                        class="w-10 h-10 rounded-full"
                      />
                      {% else %} N/A {% endif %}
                    </span>
                  </div>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div class="empty-state">
          <div class="empty-icon">üòî</div>
          <p class="empty-text">No contacts found. Add some to get started!</p>
        </div>
        {% endif %}
      </div>

      <!-- Fun Feature: Confetti Toggle -->
      <button
        class="confetti-toggle"
        onclick="toggleConfetti()"
        title="Toggle Confetti (Inactive)"
      >
        üéâ
      </button>
    </div>

    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("active");
      }

      function toggleUserDetails(userId) {
        const details = document.getElementById(`${userId}-details`);
        details.classList.toggle("show");
        const button = document.querySelector(
          `button[onclick="toggleUserDetails('${userId}')"]`
        );
        const icon = button.querySelector("svg");
        if (details.classList.contains("show")) {
          icon.innerHTML = `<path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />`;
        } else {
          icon.innerHTML = `<path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />`;
        }
      }

      function deleteUser(userId) {
        if (confirm("Are you sure you want to delete this user?")) {
          fetch(`/delete_user/${userId}`, {
            method: "DELETE",
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                const userRow = document.getElementById(`user-${userId}`);
                const detailsRow = document.getElementById(`${userId}-details`);
                if (userRow && detailsRow) {
                  userRow.remove();
                  detailsRow.remove();
                }
                checkEmptyState();
              } else {
                alert(`Error: ${data.message}`);
              }
            })
            .catch((error) => {
              console.error("Error deleting user:", error);
              alert("Something went wrong while deleting the user.");
            });
        }
      }

      function checkEmptyState() {
        const tableBody = document.getElementById("contactTableBody");
        const emptyState = document.querySelector(".empty-state");
        if (tableBody && tableBody.children.length === 0) {
          emptyState.style.display = "block";
        } else {
          emptyState.style.display = "none";
        }
      }

      function searchContacts() {
        const input = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const rows = document.querySelectorAll(
          "#contactTableBody tr:not(.user-details)"
        );
        rows.forEach((row) => {
          const username = row.cells[0].textContent.toLowerCase();
          const email = row.cells[1].textContent.toLowerCase();
          const phone = row.cells[2].textContent.toLowerCase();
          row.style.display =
            username.includes(input) ||
            email.includes(input) ||
            phone.includes(input)
              ? ""
              : "none";
        });
      }

      function toggleConfetti() {
        // Placeholder for confetti effect (inactive)
        alert("Confetti party is not active yet! üéâ Stay tuned!");
      }

      document.addEventListener("DOMContentLoaded", () => {
        checkEmptyState();
        if (window.innerWidth >= 768) {
          document.getElementById("sidebar").classList.add("active");
        }
      });
    </script>
  </body>
</html>
